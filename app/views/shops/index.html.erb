<section id="main">
  <div id="searchConditions">
    <h4>検索条件</h4>
    <dl>
      <dt>ジャンル</dt>
      <dd>：<%= @shops.conditions_categorys.join(",") %></dd>

      <dt>シチュエーション</dt>
      <dd>：<%= @shops.conditions_situation unless @shops.conditions_situation == "false" %></dd>

      <dt>地域</dt>
      <dd>：<%= @shops.area %></dd>
    </dl>
  </div>

  <div id="map">
    <div id="map_canvas"></div>
  </div>

  <div id="shopList">
    <div id="shopListInner">
      <ul>
        <% @found_shops.each do |shop| %>
          <li>
            <div id="shop">
              <%= link_to shop_path(shop.id) do %>
                <img src = <%= shop.image_path %>/>
                <div id="shopName">
                  <h2><%= shop.name %></h2>
                  <p>住所：<%= shop.address %></p>
                </div>
              <% end %>
            </div>
          </li>
        <% end %>
      </ul>
    </div>
  </div>
</section>

<script>
handler = Gmaps.build('Google');
handler.buildMap({ provider: {}, internal: {id: 'map_canvas'}}, function(){
  if(<%= @shops.area.empty? %>){
    if(navigator.geolocation)
      navigator.geolocation.getCurrentPosition(displayOnMap);
  };
  markers = handler.addMarkers(<%=raw @hash.to_json %>);
  handler.bounds.extendWith(markers);
  handler.fitMapToBounds();
});

function displayOnMap(position){
  var marker = handler.addMarker({
    lat: position.coords.latitude,
    lng: position.coords.longitude,
    picture: {
        url: 'http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=現|00F0F0|000000',
        width:  36,
        height: 36
      },
    infowindow: "現在地",
  });
  handler.map.centerOn(marker);
};
</script>
